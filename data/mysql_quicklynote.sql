CREATE TABLE IF NOT EXISTS NOTES
 (
   NOTES_ID INTEGER(2) NOT NULL  ,
   GRP_ID INTEGER(2) NULL  ,
   NOTES_LABEL TEXT NULL  
   , PRIMARY KEY (NOTES_ID) 
 ); 

CREATE TABLE IF NOT EXISTS NOTES_GROUP
 (
   GRP_ID INTEGER(2) NOT NULL  ,
   GRP_ID_PARENT INTEGER(2) NULL  ,
   GRP_LABEL TEXT NULL  
   , PRIMARY KEY (GRP_ID) 
 ); 

CREATE  INDEX I_FK_NOTES_NOTES_GROUP
     ON NOTES (GRP_ID ASC);

CREATE  INDEX I_FK_NOTES_GROUP_NOTES_GROUP
     ON NOTES_GROUP (GRP_ID_PARENT ASC);

CREATE TRIGGER IF NOT EXISTS FK_NOTES_NOTES_GROUP
BEFORE INSERT ON NOTES
FOR EACH ROW BEGIN
  SELECT CASE WHEN ((SELECT GRP_ID FROM NOTES_GROUP WHERE GRP_ID = NEW.GRP_ID) IS NULL)
    THEN RAISE(ABORT, 'Foreign Key Violation') END;
END;

ALTER TABLE NOTES_GROUP 
  ADD FOREIGN KEY (GRP_ID_PARENT)
      REFERENCES NOTES_GROUP (GRP_ID) ;
